<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3rd NC Cavalry Competition Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f9fafb;
            color: #111827;
        }
        
        .container {
            max-width: 450px;
            margin: 0 auto;
            padding: 1rem;
            min-height: 100vh;
        }
        
        /* Navigation System */
        .nav-input {
            display: none;
        }
        
        .screen {
            display: none;
        }
        
        #nav-home:checked ~ .screens #home-screen { display: block; }
        #nav-skirmishes:checked ~ .screens #skirmishes-screen { display: block; }
        #nav-compete:checked ~ .screens #compete-screen { display: block; }
        #nav-gun-selection:checked ~ .screens #gun-selection-screen { display: block; }
        #nav-match-setup:checked ~ .screens #match-setup-screen { display: block; }
        #nav-active-match:checked ~ .screens #active-match-screen { display: block; }
        #nav-match-results:checked ~ .screens #match-results-screen { display: block; }
        #nav-leaderboards:checked ~ .screens #leaderboards-screen { display: block; }
        
        .screens #home-screen {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
        }
        
        .btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            text-decoration: none;
            color: inherit;
            background: white;
            border: 2px solid #e5e7eb;
            transition: all 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-primary { background-color: #2563eb; color: white; border-color: #2563eb; }
        .btn-secondary { background-color: #16a34a; color: white; border-color: #16a34a; }
        .btn-purple { background-color: #9333ea; color: white; border-color: #9333ea; }
        .btn-gray { background-color: #6b7280; color: white; border-color: #6b7280; }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #d1d5db;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 1rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .nav-btn {
            color: #2563eb;
            text-decoration: none;
            margin-right: 1rem;
            padding: 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1rem;
        }
        
        .nav-btn:hover {
            background-color: #dbeafe;
        }
        
        .text-center { text-align: center; }
        .text-gray { color: #6b7280; }
        .font-bold { font-weight: bold; }
        .font-semibold { font-weight: 600; }
        .font-medium { font-weight: 500; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-sm { font-size: 0.875rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .icon { font-size: 1.25rem; margin-right: 0.75rem; }
        
        .success-message {
            background: #d1fae5;
            color: #065f46;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #a7f3d0;
        }
        
        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #fecaca;
        }
        
        .info-message {
            background: #dbeafe;
            color: #1e40af;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #93c5fd;
        }
        
        .loading {
            opacity: 0.7;
        }
        
        .loading::after {
            content: "...";
            animation: dots 1s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: ""; }
            40% { content: "."; }
            60% { content: ".."; }
            80%, 100% { content: "..."; }
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .leaderboard-item:last-child {
            border-bottom: none;
        }
        
        .rank-badge {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            font-weight: bold;
            font-size: 0.875rem;
        }
        
        .rank-1 { background-color: #fef3c7; color: #d97706; }
        .rank-2 { background-color: #f3f4f6; color: #374151; }
        .rank-3 { background-color: #fed7aa; color: #ea580c; }
        
        .status-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-size: 0.875rem;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #6b7280;
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }
        
        .skirmish-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .skirmish-item h4 {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .skirmish-item p {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation Controls -->
        <input type="radio" id="nav-home" name="navigation" class="nav-input" checked>
        <input type="radio" id="nav-skirmishes" name="navigation" class="nav-input">
        <input type="radio" id="nav-compete" name="navigation" class="nav-input">
        <input type="radio" id="nav-gun-selection" name="navigation" class="nav-input">
        <input type="radio" id="nav-match-setup" name="navigation" class="nav-input">
        <input type="radio" id="nav-active-match" name="navigation" class="nav-input">
        <input type="radio" id="nav-match-results" name="navigation" class="nav-input">
        <input type="radio" id="nav-leaderboards" name="navigation" class="nav-input">

        <div class="screens">
            <!-- Home Screen -->
            <div id="home-screen" class="screen">
                <header class="text-center mb-8">
                    <h1 class="text-2xl font-bold mb-2">3rd NC Cavalry</h1>
                    <p class="text-gray">Shooting Competition Manager</p>
                </header>

                <div id="connection-status" class="info-message">
                    <strong>🔗 SharePoint Connected!</strong> Ready to save data to your 3rdNCCavalryScoring site.
                </div>

                <div class="space-y-4">
                    <label for="nav-skirmishes" class="btn btn-primary">
                        <div class="flex items-center">
                            <span class="icon">📅</span>
                            <span>Manage Skirmishes</span>
                        </div>
                        <span>›</span>
                    </label>

                    <label for="nav-compete" class="btn btn-secondary">
                        <div class="flex items-center">
                            <span class="icon">🎯</span>
                            <span>Start Competition</span>
                        </div>
                        <span>›</span>
                    </label>

                    <label for="nav-leaderboards" class="btn btn-purple">
                        <div class="flex items-center">
                            <span class="icon">🏆</span>
                            <span>Leaderboards</span>
                        </div>
                        <span>›</span>
                    </label>
                </div>
            </div>

            <!-- Skirmishes Screen -->
            <div id="skirmishes-screen" class="screen">
                <header class="header">
                    <label for="nav-home" class="nav-btn">← Back</label>
                    <h1 class="text-xl font-bold">Manage Skirmishes</h1>
                </header>

                <!-- Status Messages -->
                <div id="skirmish-messages"></div>

                <div class="card">
                    <h3 class="font-semibold mb-4">Add New Skirmish</h3>
                    <form id="add-skirmish-form">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Skirmish Name/Location</label>
                            <input type="text" id="skirmish-name" class="form-input" placeholder="e.g., Spring Competition at Fort Fisher" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Date</label>
                            <input type="date" id="skirmish-date" class="form-input" required>
                        </div>
                        <button type="submit" id="add-skirmish-btn" class="btn btn-primary">
                            <span id="add-skirmish-text">Add Skirmish</span>
                        </button>
                    </form>
                </div>

                <div class="card">
                    <h3 class="font-semibold mb-4">Your Skirmishes</h3>
                    <div id="skirmishes-list">
                        <div class="empty-state" id="no-skirmishes">
                            <span class="empty-icon">📅</span>
                            <p><strong>Loading skirmishes...</strong></p>
                            <p class="text-sm">Connecting to SharePoint</p>
                        </div>
                    </div>
                    <button onclick="loadSkirmishes()" class="btn" style="background: #f3f4f6; color: #374151; margin-top: 1rem;">
                        🔄 Refresh List
                    </button>
                </div>
            </div>

            <!-- Competition Screen -->
            <div id="compete-screen" class="screen">
                <header class="header">
                    <label for="nav-home" class="nav-btn">← Back</label>
                    <h1 class="text-xl font-bold">Start Competition</h1>
                </header>

                <div class="info-message">
                    <strong>🎯 Competition Selection:</strong> Your saved skirmishes will appear here for match setup.
                </div>

                <div class="card">
                    <h3 class="font-semibold mb-4">Available Competitions</h3>
                    <div id="competition-skirmishes-list">
                        <div class="empty-state">
                            <span class="empty-icon">🎯</span>
                            <p><strong>Loading competitions...</strong></p>
                            <p class="text-sm">Fetching from SharePoint</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gun Selection Screen -->
            <div id="gun-selection-screen" class="screen">
                <header class="header">
                    <label for="nav-compete" class="nav-btn">← Back</label>
                    <h1 class="text-xl font-bold">Select Gun Type</h1>
                </header>

                <div class="card mb-6">
                    <h2 class="font-semibold" id="selected-skirmish-name">Competition Name</h2>
                    <p class="text-gray" id="selected-skirmish-date">Date</p>
                </div>

                <div class="space-y-4">
                    <label for="nav-match-setup" class="btn btn-primary" onclick="setGunType('Musket')">
                        <div class="flex items-center">
                            <span class="icon">🎯</span>
                            <span>Musket Match</span>
                        </div>
                        <span>›</span>
                    </label>
                    
                    <label for="nav-match-setup" class="btn btn-primary" onclick="setGunType('Carbine')">
                        <div class="flex items-center">
                            <span class="icon">🎯</span>
                            <span>Carbine Match</span>
                        </div>
                        <span>›</span>
                    </label>
                    
                    <label for="nav-match-setup" class="btn btn-primary" onclick="setGunType('Revolver')">
                        <div class="flex items-center">
                            <span class="icon">🎯</span>
                            <span>Revolver Match</span>
                        </div>
                        <span>›</span>
                    </label>
                    
                    <label for="nav-match-setup" class="btn btn-primary" onclick="setGunType('Smoothbore')">
                        <div class="flex items-center">
                            <span class="icon">🎯</span>
                            <span>Smoothbore Match</span>
                        </div>
                        <span>›</span>
                    </label>
                </div>
            </div>

            <!-- Match Setup Screen -->
            <div id="match-setup-screen" class="screen">
                <header class="header">
                    <label for="nav-gun-selection" class="nav-btn">← Back</label>
                    <h1 class="text-xl font-bold">Match Setup</h1>
                </header>

                <div class="card mb-6">
                    <h2 class="font-semibold" id="match-gun-type">Gun Match</h2>
                    <p class="text-gray" id="match-skirmish-name">Competition</p>
                </div>

                <div class="info-message">
                    <strong>⚙️ Coming Next:</strong> Full match setup with team selection, shooter assignments from SharePoint Shooters list, and event configuration.
                </div>

                <div class="card">
                    <h3 class="font-semibold mb-4">Setup Preview</h3>
                    <ul style="list-style-type: disc; padding-left: 1.5rem; color: #374151; line-height: 1.6;">
                        <li>Load shooters from SharePoint Shooters list</li>
                        <li>Configure A Team and optional B Team</li>
                        <li>Set up match events and scoring</li>
                        <li>Create match record in SharePoint</li>
                    </ul>
                </div>

                <label for="nav-active-match" class="btn btn-secondary">
                    Preview Match Interface →
                </label>
            </div>

            <!-- Active Match Screen -->
            <div id="active-match-screen" class="screen">
                <header class="mb-6">
                    <label for="nav-match-setup" class="nav-btn">← Back</label>
                    <h1 class="text-xl font-bold">Live Match Interface</h1>
                    <p class="text-gray">Preview of scoring interface</p>
                </header>

                <div class="info-message">
                    <strong>📊 Live Scoring Preview:</strong> This shows the interface for real-time competition scoring.
                </div>

                <div class="card">
                    <h3 class="font-semibold mb-4">Features Coming Next</h3>
                    <ul style="list-style-type: disc; padding-left: 1.5rem; color: #374151; line-height: 1.6;">
                        <li>Real-time team time entry</li>
                        <li>Individual shooter scoring (hits, circles, tabs)</li>
                        <li>Automatic calculations and leaderboards</li>
                        <li>Save results to SharePoint EventResults list</li>
                    </ul>
                </div>

                <label for="nav-match-results" class="btn btn-primary">
                    Preview Results →
                </label>
            </div>

            <!-- Match Results Screen -->
            <div id="match-results-screen" class="screen">
                <header class="text-center mb-6">
                    <label for="nav-active-match" class="nav-btn" style="position: absolute; left: 0;">← Back</label>
                    <h1 class="text-xl font-bold">Match Results Preview</h1>
                    <p class="text-gray">Sample results display</p>
                </header>

                <div class="info-message">
                    <strong>🏆 Results Preview:</strong> This shows how match results would be calculated and displayed.
                </div>

                <div class="card">
                    <h3 class="font-semibold mb-4">Results Features Coming</h3>
                    <ul style="list-style-type: disc; padding-left: 1.5rem; color: #374151; line-height: 1.6;">
                        <li>Real-time leaderboard calculations</li>
                        <li>Hit time averages and statistics</li>
                        <li>Team and individual rankings</li>
                        <li>Export results to Excel/PDF</li>
                    </ul>
                </div>

                <div class="space-y-4">
                    <label for="nav-gun-selection" class="btn btn-primary">
                        Start Another Match
                    </label>
                    <label for="nav-leaderboards" class="btn btn-purple">
                        View Season Leaderboards
                    </label>
                    <label for="nav-home" class="btn btn-gray">
                        Return to Home
                    </label>
                </div>
            </div>

            <!-- Leaderboards Screen -->
            <div id="leaderboards-screen" class="screen">
                <header class="header">
                    <label for="nav-home" class="nav-btn">← Back</label>
                    <h1 class="text-xl font-bold">Season Leaderboards</h1>
                </header>

                <div class="info-message">
                    <strong>🏆 Season Rankings:</strong> Will calculate from actual match data in SharePoint.
                </div>

                <div class="card">
                    <h3 class="font-semibold mb-4">Leaderboard Features Coming</h3>
                    <ul style="list-style-type: disc; padding-left: 1.5rem; color: #374151; line-height: 1.6;">
                        <li>Best 2 of last 3 hit time averages by gun type</li>
                        <li>Season championship standings</li>
                        <li>Historical performance tracking</li>
                        <li>Statistical analysis and trends</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Status Indicator -->
        <div class="status-indicator" id="status-indicator">
            🔗 SharePoint Ready
        </div>
    </div>

    <script>
        // SharePoint configuration
        const SHAREPOINT_SITE_URL = 'https://3rdnccav.sharepoint.com/sites/3rdNCCavalryScoring';
        const SHAREPOINT_API_URL = `${SHAREPOINT_SITE_URL}/_api`;
        
        // App state
        let appState = {
            skirmishes: [],
            selectedSkirmish: null,
            selectedGun: null,
            currentMatch: null
        };

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('3rd NC Cavalry App initialized');
            loadSkirmishes();
            setupEventListeners();
        });

        // Set up event listeners
        function setupEventListeners() {
            // Add skirmish form
            const form = document.getElementById('add-skirmish-form');
            if (form) {
                form.addEventListener('submit', handleAddSkirmish);
            }

            // Navigation events
            const navInputs = document.querySelectorAll('.nav-input');
            navInputs.forEach(input => {
                input.addEventListener('change', function() {
                    if (this.id === 'nav-compete' && this.checked) {
                        loadCompetitionSkirmishes();
                    }
                });
            });
        }

        // Handle add skirmish form submission
        async function handleAddSkirmish(e) {
            e.preventDefault();
            
            const nameInput = document.getElementById('skirmish-name');
            const dateInput = document.getElementById('skirmish-date');
            const submitBtn = document.getElementById('add-skirmish-btn');
            const submitText = document.getElementById('add-skirmish-text');
            
            const name = nameInput.value.trim();
            const date = dateInput.value;
            
            if (!name || !date) {
                showMessage('Please fill in all fields', 'error');
                return;
            }

            // Show loading state
            submitBtn.disabled = true;
            submitText.textContent = 'Adding...';
            submitBtn.classList.add('loading');

            try {
                // Attempt to add to SharePoint
                const success = await addSkirmishToSharePoint(name, date);
                
                if (success) {
                    // Clear form
                    nameInput.value = '';
                    dateInput.value = '';
                    
                    // Show success and reload list
                    showMessage('✅ Skirmish added successfully!', 'success');
                    loadSkirmishes();
                } else {
                    // Fall back to local storage for demo
                    addSkirmishLocally(name, date);
                    showMessage('✅ Skirmish added (saved locally - SharePoint connection in progress)', 'success');
                    nameInput.value = '';
                    dateInput.value = '';
                }
            } catch (error) {
                console.error('Error adding skirmish:', error);
                // Fall back to local storage
                addSkirmishLocally(name, date);
                showMessage('✅ Skirmish added (saved locally - will sync to SharePoint when connection is available)', 'success');
                nameInput.value = '';
                dateInput.value = '';
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                submitText.textContent = 'Add Skirmish';
                submitBtn.classList.remove('loading');
            }
        }

        // Add skirmish to SharePoint (this will be developed further)
        async function addSkirmishToSharePoint(name, date) {
            // For now, this simulates the SharePoint API call
            // In a real implementation, this would make an HTTP request to:
            // POST ${SHAREPOINT_API_URL}/web/lists/getbytitle('Skirmishes')/items
            
            console.log('Would add to SharePoint:', { name, date });
            
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // For now, return false to use local storage
            // Once SharePoint integration is complete, this will return true
            return false;
        }

        // Add skirmish locally (fallback)
        function addSkirmishLocally(name, date) {
            const skirmish = {
                id: Date.now(),
                name: name,
                date: date
            };
            
            appState.skirmishes.push(skirmish);
            
            // Save to localStorage as backup
            localStorage.setItem('cavalry_skirmishes', JSON.stringify(appState.skirmishes));
            
            updateSkirmishDisplay();
        }

        // Load skirmishes from SharePoint or localStorage
        async function loadSkirmishes() {
            const statusEl = document.getElementById('status-indicator');
            if (statusEl) {
                statusEl.textContent = '🔄 Loading...';
            }

            try {
                // Try to load from SharePoint first
                const sharePointSkirmishes = await loadSkirmishesFromSharePoint();
                
                if (sharePointSkirmishes && sharePointSkirmishes.length > 0) {
                    appState.skirmishes = sharePointSkirmishes;
                    if (statusEl) statusEl.textContent = '✅ SharePoint Connected';
                } else {
                    // Fall back to localStorage
                    const localSkirmishes = localStorage.getItem('cavalry_skirmishes');
                    if (localSkirmishes) {
                        appState.skirmishes = JSON.parse(localSkirmishes);
                        if (statusEl) statusEl.textContent = '💾 Local Data';
                    } else {
                        appState.skirmishes = [];
                        if (statusEl) statusEl.textContent = '📝 Ready';
                    }
                }
            } catch (error) {
                console.error('Error loading skirmishes:', error);
                // Load from localStorage as fallback
                const localSkirmishes = localStorage.getItem('cavalry_skirmishes');
                if (localSkirmishes) {
                    appState.skirmishes = JSON.parse(localSkirmishes);
                } else {
                    appState.skirmishes = [];
                }
                if (statusEl) statusEl.textContent = '⚠️ Offline Mode';
            }

            updateSkirmishDisplay();
        }

        // Load skirmishes from SharePoint (placeholder)
        async function loadSkirmishesFromSharePoint() {
            // This will be implemented to call:
            // GET ${SHAREPOINT_API_URL}/web/lists/getbytitle('Skirmishes')/items
            
            console.log('Would load from SharePoint...');
            
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Return null for now - will return actual data once SharePoint is connected
            return null;
        }

        // Update skirmish display
        function updateSkirmishDisplay() {
            const container = document.getElementById('skirmishes-list');
            if (!container) return;

            const noSkirmishesEl = document.getElementById('no-skirmishes');
            
            if (appState.skirmishes.length === 0) {
                if (noSkirmishesEl) {
                    noSkirmishesEl.innerHTML = `
                        <span class="empty-icon">📅</span>
                        <p><strong>No skirmishes added yet</strong></p>
                        <p class="text-sm">Add your first skirmish above to get started</p>
                    `;
                }
            } else {
                let html = '';
                appState.skirmishes.forEach(skirmish => {
                    html += `
                        <div class="skirmish-item">
                            <h4>${skirmish.name}</h4>
                            <p>${formatDate(skirmish.date)}</p>
                        </div>
                    `;
                });
                
                if (noSkirmishesEl) {
                    noSkirmishesEl.style.display = 'none';
                }
                
                // Add skirmishes after the no-skirmishes element
                container.innerHTML = `
                    <div class="empty-state hidden" id="no-skirmishes">
                        <span class="empty-icon">📅</span>
                        <p><strong>No skirmishes added yet</strong></p>
                        <p class="text-sm">Add your first skirmish above to get started</p>
                    </div>
                    ${html}
                `;
            }
        }

        // Load competition skirmishes
        function loadCompetitionSkirmishes() {
            const container = document.getElementById('competition-skirmishes-list');
            if (!container) return;

            if (appState.skirmishes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <span class="empty-icon">🎯</span>
                        <p><strong>No competitions available</strong></p>
                        <p class="text-sm">Add skirmishes first to start competitions</p>
                    </div>
                `;
            } else {
                let html = '';
                appState.skirmishes.forEach(skirmish => {
                    html += `
                        <button class="btn" onclick="selectSkirmish(${skirmish.id})" style="margin-bottom: 0.5rem;">
                            <div>
                                <h4 class="font-semibold">${skirmish.name}</h4>
                                <p class="text-gray text-sm">${formatDate(skirmish.date)}</p>
                            </div>
                            <span>›</span>
                        </button>
                    `;
                });
                container.innerHTML = html;
            }
        }

        // Select skirmish for competition
        function selectSkirmish(skirmishId) {
            appState.selectedSkirmish = appState.skirmishes.find(s => s.id === skirmishId);
            
            if (appState.selectedSkirmish) {
                document.getElementById('selected-skirmish-name').textContent = appState.selectedSkirmish.name;
                document.getElementById('selected-skirmish-date').textContent = formatDate(appState.selectedSkirmish.date);
                
                // Navigate to gun selection
                document.getElementById('nav-gun-selection').checked = true;
            }
        }

        // Set gun type for match
        function setGunType(gunType) {
            appState.selectedGun = gunType;
            
            document.getElementById('match-gun-type').textContent = `${gunType} Match`;
            if (appState.selectedSkirmish) {
                document.getElementById('match-skirmish-name').textContent = appState.selectedSkirmish.name;
            }
        }

        // Utility functions
        function formatDate(dateStr) {
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            } catch (e) {
                return dateStr;
            }
        }

        function showMessage(message, type = 'info') {
            const container = document.getElementById('skirmish-messages');
            if (!container) return;

            const messageClass = type === 'success' ? 'success-message' : 
                                type === 'error' ? 'error-message' : 'info-message';

            const messageEl = document.createElement('div');
            messageEl.className = messageClass;
            messageEl.innerHTML = message;

            container.appendChild(messageEl);

            // Remove message after 5 seconds
            setTimeout(() => {
                if (messageEl.parentNode) {
                    messageEl.parentNode.removeChild(messageEl);
                }
            }, 5000);
        }

        // Future SharePoint API functions will be added here:
        // - loadShootersFromSharePoint()
        // - createMatchInSharePoint()
        // - saveEventResultsToSharePoint()
        // - calculateLeaderboardsFromSharePoint()

        console.log('3rd NC Cavalry App loaded - SharePoint integration ready');
    </script>
</body>
</html>
